<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carta</title>

<style>
/* ===== RESET ===== */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* ===== BODY ===== */
body {
  background: radial-gradient(circle at top, #0e0e0e, #000);
  min-height: 100vh;
  height: 100vh;
  font-family: 'Georgia', serif;
  overflow: hidden;
  color: #2b2b2b;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar {
  width: 6px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: rgba(180,180,180,.35);
  border-radius: 10px;
}

/* ===== CANVAS PARTICULAS ===== */
#particles {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
}

/* ===== OSCURIDAD ===== */
#darkOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0);
  pointer-events: none;
  transition: background 3s ease;
  z-index: 2;
}

/* ===== RESPLANDOR DE VELA ===== */
#candleGlow {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 50% 95%, rgba(255,200,100,0) 0%, rgba(255,200,100,0) 100%);
  pointer-events: none;
  opacity: 0;
  transition: opacity 3s ease;
  z-index: 2;
}

#candleGlow.active {
  background: radial-gradient(circle at 50% 95%, rgba(255,200,100,0.35) 0%, rgba(255,180,80,0.25) 15%, rgba(255,150,50,0.15) 30%, rgba(255,120,30,0.08) 45%, transparent 65%);
  opacity: 1;
}

/* ===== CARTA ===== */
.container {
  position: relative;
  z-index: 3;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  padding-bottom: 45px;
  height: 100vh;
}

.letter {
  background: #f3e7cf;
  max-width: 720px;
  width: 100%;
  max-height: calc(100vh - 240px);
  padding: 25px;
  border-radius: 6px;
  box-shadow: 
    0 30px 60px rgba(0,0,0,.5),
    inset 0 0 40px rgba(0,0,0,.05);
  overflow-y: auto;
  overflow-x: hidden;
  transform: translateY(-25px);
}

/* Scroll personalizado para la carta */
.letter::-webkit-scrollbar {
  width: 8px;
}

.letter::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.1);
  border-radius: 10px;
}

.letter::-webkit-scrollbar-thumb {
  background: rgba(139,115,85,0.5);
  border-radius: 10px;
}

.letter::-webkit-scrollbar-thumb:hover {
  background: rgba(139,115,85,0.7);
}

/* ===== TEXTO ===== */
#text {
  font-size: 1.05rem;
  line-height: 1.8;
  color: #2f2f2f;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Efecto de brillo en palabras clave */
.highlight {
  color: #d4af37;
  text-shadow: 0 0 8px rgba(212,175,55,0.4);
  font-weight: bold;
  animation: glow 2s ease-in-out;
}

@keyframes glow {
  0%, 100% { text-shadow: 0 0 8px rgba(212,175,55,0.4); }
  50% { text-shadow: 0 0 15px rgba(212,175,55,0.7); }
}

/* ===== VELA ===== */
#candle {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 50px;
  height: 120px;
  display: none;
  z-index: 4;
  filter: drop-shadow(0 0 20px rgba(255,200,100,0.4));
  transition: opacity 0.5s ease, transform 0.5s ease;
}

#candle.hide {
  opacity: 0;
  transform: translateX(-50%) scale(0.8);
}

#candle::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 80px;
  background: linear-gradient(to bottom, #f5f5f5 0%, #ececec 50%, #d9d9d9 100%);
  border-radius: 8px 8px 4px 4px;
  box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
}

#candle::after {
  content: '';
  position: absolute;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 3px;
  height: 10px;
  background: #2a2a2a;
  border-radius: 50% 50% 0 0;
}

#flame {
  position: absolute;
  top: 8px;
  left: 50%;
  width: 20px;
  height: 35px;
  background: radial-gradient(ellipse at center, #fff 0%, #ffd700 15%, #ff9f1c 40%, #ff6b00 70%, transparent 85%);
  transform: translateX(-50%);
  border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
  animation: flicker 1.5s infinite ease-in-out;
  box-shadow: 
    0 0 20px rgba(255,200,100,0.8),
    0 0 40px rgba(255,150,50,0.5),
    0 0 60px rgba(255,100,0,0.3);
}

#flame::before {
  content: '';
  position: absolute;
  top: 5px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 20px;
  background: radial-gradient(ellipse at center, #fff 0%, #ffffcc 30%, transparent 70%);
  border-radius: 50%;
}

/* ===== BOT√ìN DE REGALO ===== */
#giftButton {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) scale(0);
  padding: 15px 35px;
  background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
  color: #2a2a2a;
  font-family: 'Georgia', serif;
  font-size: 1.1rem;
  font-weight: bold;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  z-index: 4;
  box-shadow: 
    0 8px 25px rgba(212,175,55,0.4),
    inset 0 1px 0 rgba(255,255,255,0.3);
  transition: all 0.3s ease;
  opacity: 0;
}

#giftButton.show {
  animation: giftAppear 0.6s ease forwards;
}

@keyframes giftAppear {
  0% {
    opacity: 0;
    transform: translateX(-50%) scale(0) rotate(-180deg);
  }
  60% {
    transform: translateX(-50%) scale(1.1) rotate(10deg);
  }
  100% {
    opacity: 1;
    transform: translateX(-50%) scale(1) rotate(0deg);
  }
}

#giftButton:hover {
  background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
  transform: translateX(-50%) scale(1.05);
  box-shadow: 
    0 12px 35px rgba(212,175,55,0.6),
    inset 0 1px 0 rgba(255,255,255,0.4);
}

#giftButton:active {
  transform: translateX(-50%) scale(0.95);
}

@keyframes flicker {
  0%, 100% { 
    transform: translateX(-50%) scale(1) translateY(0); 
    opacity: 1;
  }
  25% { 
    transform: translateX(-48%) scale(0.95, 1.05) translateY(-2px); 
    opacity: 0.9;
  }
  50% { 
    transform: translateX(-52%) scale(0.92, 1.08) translateY(-1px); 
    opacity: 0.85;
  }
  75% { 
    transform: translateX(-50%) scale(0.98, 1.02) translateY(-3px); 
    opacity: 0.95;
  }
}

/* ===== EFECTOS ESPECIALES ===== */
#teardrops {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 5;
}

.bright {
  animation: brighten 2s ease-in;
}

@keyframes brighten {
  0% { filter: brightness(0.7); }
  100% { filter: brightness(1); }
}

/* ===== RESPONSIVE ===== */
@media (max-width: 600px) {
  .container {
    padding: 15px;
  }
  .letter {
    max-height: calc(100vh - 200px);
    padding: 20px;
  }
  #text {
    font-size: 1rem;
    line-height: 1.7;
  }
  #candle {
    bottom: 15px;
    width: 40px;
    height: 100px;
  }
  #candle::before {
    width: 32px;
    height: 65px;
  }
  #candle::after {
    bottom: 65px;
  }
  #flame {
    width: 16px;
    height: 28px;
    top: 6px;
  }
}

@media (max-width: 400px) {
  .container {
    padding: 10px;
  }
  .letter {
    max-height: calc(100vh - 180px);
    padding: 18px;
  }
  #text {
    font-size: 0.95rem;
  }
}
</style>
</head>
<body>

<canvas id="particles"></canvas>
<canvas id="teardrops"></canvas>
<div id="darkOverlay"></div>
<div id="candleGlow"></div>

<div class="container">
  <div class="letter">
    <div id="text"></div>
  </div>
</div>

<div id="candle">
  <div id="flame"></div>
</div>

<button id="giftButton">üéÅ Abrir Regalo</button>

<script>
/* ===== TEXTO EXACTO CON SALTOS DE L√çNEA ===== */
const message = `Hola.

Si est√°s leyendo esto, seguramente es porque eres ‚Äîo fuiste‚Äî alguien importante en mi vida. Me ense√±aste lo que estaba bien, pero tambi√©n lo que estaba mal, y t√∫, que te mantuviste a mi lado a pesar de mis grandes defectos, gracias.

Este a√±o pasaron muchas cosas: sonre√≠ y llor√©, me enoj√© y me alegr√©. Pasaron cosas malas, pero tambi√©n cosas buenas, y el simple hecho de que ambas hayan existido ya es una bendici√≥n.

Hay muchas cosas de las que me arrepiento y otras de las que estoy orgulloso.

Este a√±o pas√≥ algo que fue lo peor, pero tambi√©n lo mejor al mismo tiempo. Llegu√© a un punto en mi vida en el que quer√≠a acabar con ella; sent√≠a que no val√≠a la pena seguir adelante, cre√≠a que ya no hab√≠a nada m√°s por qu√© vivir.

No era tan valiente como para quitarme la vida, hasta que un d√≠a me quebr√© y le cont√© todo a un amigo que hoy puedo llamar hermano.

√âl me ense√±√≥ a ver la luz en medio de la oscuridad, me dio una raz√≥n para vivir, y le agradezco por mostrarme lo que es la verdad.

Ahora, t√∫ que est√°s leyendo esto, no es casualidad, como bien sabes.

No soy perfecto; de hecho, soy una de las personas m√°s imperfectas que podr√≠as conocer. Y aun as√≠, Dios me acept√≥, no por lo que fui, sino por lo que puedo llegar a ser: un hijo de Dios.

Tal vez pienses que esto suena "falso", pero solo si t√∫ quieres, dale una oportunidad. No te arrepentir√°s de haber tomado esta decisi√≥n. Al final, t√∫ decides.

Gracias por formar parte de mi vida y regalarme tu amistad.

Hoy quiero entregarte un regalo a√∫n m√°s grande, pero no viene de mi parte, sino de parte de Dios.

Espero que tengas un a√±o lleno de bendiciones.

Feliz A√±o Nuevo 2026.`;

/* ===== TIPEO MEJORADO ===== */
const textEl = document.getElementById("text");
const dark = document.getElementById("darkOverlay");
const candleGlow = document.getElementById("candleGlow");
const candle = document.getElementById("candle");
const letterContainer = document.querySelector('.letter');

let i = 0;
let currentHTML = "";
let effectsApplied = {
  darkness: false,
  candle: false,
  tears: false,
  light: false,
  blessing: false,
  gratitude: false,
  hope: false
};

let teardropsActive = false;
let teardrops = [];

function type() {
  if (i < message.length) {
    const char = message[i];
    
    // Agregar el car√°cter al HTML
    if (char === '\n') {
      currentHTML += '<br>';
    } else {
      // Escapar caracteres especiales HTML
      const escaped = char
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
      currentHTML += escaped;
    }
    
    textEl.innerHTML = currentHTML;
    
    // Scroll autom√°tico hacia abajo
    letterContainer.scrollTop = letterContainer.scrollHeight;
    
    const currentText = textEl.textContent;
    
    // Efecto de gratitud al inicio
    if (!effectsApplied.gratitude && currentText.includes("gracias")) {
      // Part√≠culas de luz suave
      for(let j = 0; j < 20; j++) {
        particles.push({
          x: Math.random()*w,
          y: Math.random()*h,
          r: Math.random()*2+1,
          s: Math.random()*0.35+0.15,
          golden: false,
          soft: true
        });
      }
      effectsApplied.gratitude = true;
    }
    
    // Efecto de l√°grimas azules cayendo
    if (!effectsApplied.tears && currentText.includes("sonre√≠ y llor√©")) {
      teardropsActive = true;
      effectsApplied.tears = true;
      
      // Detener l√°grimas despu√©s de 4 segundos
      setTimeout(() => {
        teardropsActive = false;
      }, 4000);
    }
    
    // Efecto de oscuridad profunda
    if (!effectsApplied.darkness && currentText.includes("quer√≠a acabar con ella")) {
      dark.style.background = "rgba(0,0,0,.92)";
      // Reducir part√≠culas en la oscuridad
      particles.forEach(p => {
        if(!p.golden) p.s *= 0.3;
      });
      effectsApplied.darkness = true;
    }
    
    // Efecto de luz y vela (momento de esperanza)
    if (!effectsApplied.candle && currentText.includes("la luz en medio de la oscuridad")) {
      setTimeout(() => {
        dark.style.background = "rgba(0,0,0,.65)";
        candle.style.display = "block";
        candleGlow.classList.add("active");
        textEl.classList.add("bright");
        
        // Detener l√°grimas definitivamente
        teardropsActive = false;
        
        // Restaurar velocidad de part√≠culas
        particles.forEach(p => {
          if(!p.golden) p.s = Math.random()*0.3+0.1;
        });
        
        // Agregar part√≠culas de esperanza
        for(let j = 0; j < 30; j++) {
          particles.push({
            x: Math.random()*w,
            y: Math.random()*h,
            r: Math.random()*2.5+1,
            s: Math.random()*0.4+0.2,
            golden: false,
            warm: true
          });
        }
      }, 500);
      effectsApplied.candle = true;
    }
    
    // Efecto de aceptaci√≥n divina
    if (!effectsApplied.hope && currentText.includes("Dios me acept√≥")) {
      // Part√≠culas celestiales
      for(let j = 0; j < 35; j++) {
        particles.push({
          x: Math.random()*w,
          y: h + Math.random()*100,
          r: Math.random()*3+1.5,
          s: Math.random()*0.5+0.25,
          golden: true,
          divine: true
        });
      }
      effectsApplied.hope = true;
    }
    
    // Efecto de bendici√≥n final
    if (!effectsApplied.blessing && currentText.includes("bendiciones")) {
      // Explosi√≥n de part√≠culas doradas
      for(let j = 0; j < 50; j++) {
        particles.push({
          x: Math.random()*w,
          y: Math.random()*h,
          r: Math.random()*3+1.5,
          s: Math.random()*0.5+0.3,
          golden: true,
          blessing: true
        });
      }
      
      // Aumentar brillo del fondo
      setTimeout(() => {
        dark.style.background = "rgba(0,0,0,.55)";
      }, 1000);
      
      effectsApplied.blessing = true;
    }

    i++;
    setTimeout(type, 60);
  } else {
    // Cuando termina el tipeo, esperar 10 segundos y mostrar bot√≥n
    setTimeout(() => {
      // Ocultar vela
      candle.classList.add('hide');
      
      // Mostrar bot√≥n despu√©s de que la vela desaparezca
      setTimeout(() => {
        candle.style.display = 'none';
        const giftBtn = document.getElementById('giftButton');
        giftBtn.classList.add('show');
        
        // Agregar evento de clic
        giftBtn.onclick = () => {
          window.location.href = 'regalo.html';
        };
      }, 500);
    }, 10000);
  }
}

// Iniciar tipeo despu√©s de un breve delay
setTimeout(type, 800);

/* ===== PARTICULAS DE LUZ MEJORADAS ===== */
const canvas = document.getElementById("particles");
const ctx = canvas.getContext("2d");
const tearCanvas = document.getElementById("teardrops");
const tearCtx = tearCanvas.getContext("2d");
let w, h;

function resize() {
  w = canvas.width = tearCanvas.width = window.innerWidth;
  h = canvas.height = tearCanvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

const particles = Array.from({length: 100}, () => ({
  x: Math.random()*w,
  y: Math.random()*h,
  r: Math.random()*2+1,
  s: Math.random()*0.3+0.1,
  golden: false
}));

// Sistema de l√°grimas
function createTear() {
  if (!teardropsActive) return;
  
  const letterRect = document.querySelector('.letter').getBoundingClientRect();
  const side = Math.random() < 0.5 ? 'left' : 'right';
  
  teardrops.push({
    x: side === 'left' ? letterRect.left - 30 : letterRect.right + 30,
    y: letterRect.top + Math.random() * 100,
    size: Math.random() * 4 + 3,
    speed: Math.random() * 3 + 2,
    opacity: Math.random() * 0.6 + 0.4
  });
}

// Crear l√°grimas constantemente cuando est√° activo
setInterval(createTear, 200);

function animateTears() {
  tearCtx.clearRect(0, 0, w, h);
  
  for (let i = teardrops.length - 1; i >= 0; i--) {
    const tear = teardrops[i];
    tear.y += tear.speed;
    
    // Dibujar l√°grima azul
    tearCtx.fillStyle = `rgba(100, 150, 255, ${tear.opacity})`;
    tearCtx.beginPath();
    tearCtx.ellipse(tear.x, tear.y, tear.size * 0.7, tear.size, 0, 0, Math.PI * 2);
    tearCtx.fill();
    
    // Brillo
    tearCtx.fillStyle = `rgba(150, 200, 255, ${tear.opacity * 0.4})`;
    tearCtx.beginPath();
    tearCtx.arc(tear.x, tear.y - tear.size * 0.3, tear.size * 0.5, 0, Math.PI * 2);
    tearCtx.fill();
    
    // Remover si sale de la pantalla
    if (tear.y > h + 20) {
      teardrops.splice(i, 1);
    }
  }
  
  requestAnimationFrame(animateTears);
}
animateTears();

function animate() {
  ctx.clearRect(0,0,w,h);
  particles.forEach(p=>{
    p.y -= p.s;
    if(p.y < -10) {
      p.y = h + 10;
      p.x = Math.random()*w;
    }
    
    // Diferentes estilos de part√≠culas
    if(p.divine) {
      // Part√≠culas divinas (blanco brillante)
      ctx.fillStyle = "rgba(255,255,255,.5)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
      
      // Halo brillante
      ctx.fillStyle = "rgba(255,245,200,.3)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r*2, 0, Math.PI*2);
      ctx.fill();
    } else if(p.blessing) {
      // Part√≠culas de bendici√≥n (dorado intenso)
      ctx.fillStyle = "rgba(255,215,0,.6)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
      
      // Brillo extra
      ctx.fillStyle = "rgba(255,255,200,.35)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r*1.8, 0, Math.PI*2);
      ctx.fill();
    } else if(p.golden) {
      // Part√≠culas doradas normales
      ctx.fillStyle = "rgba(255,215,0,.45)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
      
      ctx.fillStyle = "rgba(255,255,200,.2)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r*1.5, 0, Math.PI*2);
      ctx.fill();
    } else if(p.warm) {
      // Part√≠culas c√°lidas (luz de vela)
      ctx.fillStyle = "rgba(255,200,100,.35)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
    } else if(p.soft) {
      // Part√≠culas suaves (gratitud)
      ctx.fillStyle = "rgba(255,240,200,.3)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
    } else {
      // Part√≠culas normales
      ctx.fillStyle = "rgba(255,230,180,.25)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
    }
  });
  requestAnimationFrame(animate);
}
animate();

// Ajustar posici√≥n de part√≠culas al redimensionar
window.addEventListener('resize', () => {
  particles.forEach(p => {
    if(p.x > window.innerWidth) p.x = window.innerWidth * Math.random();
  });
});
</script>

</body>
</html>
